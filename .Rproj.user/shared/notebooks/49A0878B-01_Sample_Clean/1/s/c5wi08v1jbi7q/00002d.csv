"0","## Exclude individuals with missing data"
"0","dim(dat_vis)"
"1","[1]"
"1"," 1163"
"1","   29"
"1","
"
"0","# plot_missing(dat_vis)"
"0","dat_vis = dat_vis[!is.na(dat_vis$Education),] "
"0","  # those who had missing covariates except smoking status"
"0",""
"0","## save data without imputing smoking status."
"0","write.csv(dat_vis, '00_Intermediate_output/09_Step_Cov_WithoutSmokingImpute.csv')"
"0",""
"0","## Impute missing smoking status."
"0","dat_temp = cbind(dat_vis[, colSums(is.na(dat_vis)) == 0], "
"0","                 dat_vis[, which(colnames(dat_vis) == 'Smoking')])"
"0","colnames(dat_temp)[dim(dat_temp)[2]] = 'Smoking'"
"0","dat_temp$Smoking = as.factor(dat_temp$Smoking)"
"0",""
"0","library(mice)"
"2","
Attaching package: ‘mice’

"
"2","The following object is masked from ‘package:stats’:

    filter

"
"2","The following objects are masked from ‘package:base’:

    cbind, rbind

"
"0","dat_imp = mice(dat_temp,   #include missing matrix"
"0","            m = 10,  # Imputation Number"
"0","            method = 'rf', #Imputation Methods"
"0","            printFlag = FALSE, #not show history records"
"0","            seed = 208)"
"2","Warning:"
"2"," Number of logged events: 12
"
"0","num = which(colnames(dat_temp) == 'Smoking')"
"0","dat_imp.all = do.call(cbind, lapply(1:10, function(i) complete(dat_imp, action = i)[, num, drop = FALSE]))"
"0","get_mode <- function(x) {"
"0","  uniqx <- unique(x)"
"0","  uniqx[which.max(tabulate(match(x, uniqx)))]"
"0","}"
"0","dat_temp$Smoking = apply(dat_imp.all[, 1:10], 1, get_mode)"
