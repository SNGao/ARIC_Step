"0","# Load datasets"
"0","dat_cov_V5 <- read_dta(paste0(ARIC.folder, 'covariate_V5_derive.dta')) |> mutate(BMI = bmi51)"
"0","dat_cov_V6 <- read_dta(paste0(ARIC.folder, 'covariate_V6_derive.dta')) |> mutate(BMI = bmi61)"
"0","dat_cov_V7 <- read_dta(paste0(ARIC.folder, 'covariate_V7_derive.dta')) |> mutate(BMI = bmi71)"
"0","dat_cov_V9 <- read_dta(paste0(ARIC.folder, 'covariate_V9_derive.dta')) |> mutate(BMI = bmi91)"
"0",""
"0","# Function to select columns and mutate age for each visit"
"0","select_and_mutate <- function(data, age_col) {"
"0","  data |> "
"0","    mutate(Age = !!sym(age_col)) |> "
"0","    select(-contains(""racegrp""), -contains(""drnkr""),"
"0","           -contains(""diabts""), -contains(""cogdiag""), -contains(""cancer""), "
"0","           -contains(""systolic""), -contains(""diastolic""), "
"0","           -contains(""cigt""), -contains(""sprt_i""), -contains(""lisr_i""), "
"0","           -contains(""cesd""), -contains(""gender""), -contains(""date""), "
"0","           -contains(""cogstatus""),"
"0","           -contains(""sport_index""),"
"0","           -contains(""elevel"")) |>"
"0","    select(-matches('v5age51|v6age61|v7age71|v9age91'),"
"0","           -matches('bmi51|bmi61|bmi71|bmi91'),"
"0","           -matches('sppb51|sppb61|sppb71|sppb91'))"
"0","}"
"0",""
"0","# Apply function to each dataset"
"0","dat_cov_V5_select <- select_and_mutate(dat_cov_V5, ""v5age51"")"
"0","dat_cov_V6_select <- select_and_mutate(dat_cov_V6, ""v6age61"")"
"0","dat_cov_V7_select <- select_and_mutate(dat_cov_V7, ""v7age71"")"
"0","dat_cov_V9_select <- select_and_mutate(dat_cov_V9, ""v9age91"")"
"0",""
"0","# Merge smoking and depression data from V7 to V9"
"0","dat_cov_V9_select <- merge(dat_cov_V9_select, "
"0","                           dat_cov_V7_select[, c('subjectid', 'smoking', 'Depre_CES')], "
"0","                           by = 'subjectid', all.x = TRUE)"
"0",""
"0","# Reorder columns to match visits"
"0","dat_cov_V9_select<- dat_cov_V9_select[, c(1:7,13,8,12,9,10,11)]"
"0",""
"0","# Load and process APOE4 data"
"0","dat_apoe4 <- read_dta('/Users/gsn/OneDrive - Johns Hopkins/【JHU】Aging-RA/ARIC_Data/Data/ARIC/Genetics/apoe_new_p.dta')"
"0","dat_apoe4 <- dat_apoe4 |> "
"0","  mutate(subjectid = dat_apoe4[[1]],"
"0","         final_apoe = case_when("
"0","           str_detect(final_apoe, '4') ~ 'Risk',"
"0","           str_detect(final_apoe, '2') ~ 'Protect',"
"0","           str_detect(final_apoe, '3') ~ 'Homo',"
"0","           TRUE ~ NA_character_))"
"0",""
"0","# Merge APOE4 data to all visits"
"0","visit_datasets <- list(dat_cov_V5_select, dat_cov_V6_select, dat_cov_V7_select, dat_cov_V9_select)"
"0","visit_datasets <- lapply(visit_datasets, function(df) merge(df, dat_apoe4[, c('subjectid', 'final_apoe')], by = 'subjectid', all.x = TRUE))"
"0",""
"0","# Update datasets with merged data"
"0","dat_cov_V5_select <- visit_datasets[[1]]"
"0","dat_cov_V6_select <- visit_datasets[[2]]"
"0","dat_cov_V7_select <- visit_datasets[[3]]"
"0","dat_cov_V9_select <- visit_datasets[[4]]"
"0",""
"0","# Load and merge center data"
"0","dat_center <- read_dta('/Users/gsn/OneDrive - Johns Hopkins/【JHU】Aging-RA/ARIC_Data/Data/ARIC/V1/derive13.dta') |> "
"0","  select(subjectid = 1, center)"
"0",""
"0","visit_datasets <- lapply(visit_datasets, function(df) merge(df, dat_center, by = 'subjectid', all.x = TRUE))"
"0",""
"0","# Update datasets with merged data"
"0","dat_cov_V5_select <- visit_datasets[[1]]"
"0","dat_cov_V6_select <- visit_datasets[[2]]"
"0","dat_cov_V7_select <- visit_datasets[[3]]"
"0","dat_cov_V9_select <- visit_datasets[[4]]"
"0",""
"0","# Load and process education data"
"0","dat_edu <- read_dta(paste0(ARIC.folder, 'education_V1.dta')) |> "
"0","  select(subjectid = 1, elevel02) |> "
"0","  mutate(Education = factor(elevel02, levels = c(1, 2, 3), "
"0","                            labels = c('Less than high school', "
"0","                                       'High school, GED certification, or vocational schools', "
"0","                                       'College, graduate, or professional school')))"
"0",""
"0","# Merge education data to all visits"
"0","visit_datasets <- lapply(visit_datasets, function(df) merge(df, dat_edu, by = 'subjectid', all.x = TRUE))"
"0",""
"0","# Update datasets with merged data"
"0","dat_cov_V5_select <- visit_datasets[[1]]"
"0","dat_cov_V6_select <- visit_datasets[[2]]"
"0","dat_cov_V7_select <- visit_datasets[[3]]"
"0","dat_cov_V9_select <- visit_datasets[[4]]"
"0",""
"0","# Load and merge birth data"
"0","dat_Birth <- read_dta('/Users/gsn/OneDrive - Johns Hopkins/【JHU】Aging-RA/ARIC_Data/Data/ARIC/V1/derive13.dta') |> "
"0","  select(subjectid = id, birthdat, v1date01)"
"0",""
"0","visit_datasets <- lapply(visit_datasets, function(df) merge(df, dat_Birth, by = 'subjectid', all.x = TRUE))"
"0",""
"0","# Update datasets with merged data"
"0","dat_cov_V5_select <- visit_datasets[[1]]"
"0","dat_cov_V6_select <- visit_datasets[[2]]"
"0","dat_cov_V7_select <- visit_datasets[[3]]"
"0","dat_cov_V9_select <- visit_datasets[[4]]"
"0",""
"0","# Add visit labels"
"0","dat_cov_V5_select$Visit <- 'V5'"
"0","dat_cov_V6_select$Visit <- 'V6'"
"0","dat_cov_V7_select$Visit <- 'V7'"
"0","dat_cov_V9_select$Visit <- 'V9'"
