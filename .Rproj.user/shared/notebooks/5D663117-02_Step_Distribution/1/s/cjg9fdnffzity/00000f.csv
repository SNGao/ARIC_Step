"0","## Impute missing smoking status."
"0","dat_temp = cbind(dat_vis[, -which(colnames(dat_vis) == 'Smoking')], "
"0","                 dat_vis[, which(colnames(dat_vis) == 'Smoking')])"
"0","colnames(dat_temp)[dim(dat_temp)[2]] = 'Smoking'"
"0","dat_temp$Smoking = as.factor(dat_temp$Smoking)"
"0","colnames(dat_temp)[1:(ncol(dat_temp)-1)] = paste0('var',c(1:(ncol(dat_temp)-1)))"
"0",""
"0","library(mice)"
"0","dat_imp = mice(dat_temp,   # Include missing matrix"
"0","            m = 10,  # Imputation Number"
"0","            method = 'rf', # Imputation Methods"
"0","            printFlag = FALSE, # Not show history records"
"0","            seed = 208)"
"2","Warning:"
"2"," Number of logged events: 14
"
"0","num = which(colnames(dat_temp) == 'Smoking')"
"0","dat_imp.all = do.call(cbind, "
"0","                      lapply(1:10, function(i) complete(dat_imp, action = i)[, num, drop = FALSE]))"
"0",""
"0","get_mode <- function(x) {"
"0","  uniqx <- unique(x)"
"0","  uniqx[which.max(tabulate(match(x, uniqx)))]"
"0","}"
"0",""
"0","dat_temp$Smoking = apply(dat_imp.all[, 1:10], 1, get_mode)"
"0","dat_vis$Smoking = dat_temp$Smoking"
"0","write_csv(dat_vis, '00_Intermediate_output/03_Step_Cov_Imputed.csv')"
